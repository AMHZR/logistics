{% load logistics_extras %}
{% load logistics_report_tags %}
{% load report_tags %}

<table>
    <thead>
        <tr>
            <th></th>
            <th colspan="{{ em_reports|length }}" >EM</th>
            <th colspan="{{ ept_reports|length }}" >EPT</th>
            <th colspan="2">Totals</th>
        </tr>
        <tr>
            <th>Category</th>
{% for d in em_reports %}
            <th>{{ d.name }}</th>
{% endfor %}
{% for d in ept_reports %}
            <th>{{ d.name }}</th>
{% endfor %}
            <th>EM</th>
            <th>EPT</th>
        </tr>
    </thead>
    <tbody>
    {% for p in product_codes %}
        <tr>
            <td># of HSAs with adequate stock of {% commodity_code_to_name p %}</td>
        {% for r in em_reports.values %}
            <td>
            {% if p in r %}
            {% with r|dict_lookup:p as num %}
                {% with t|dict_lookup:p as denom %}
                {% percent_cell num denom %}
                {% endwith %}
                {% endwith %}
                {% else %}
                <span style="color:gray">n/a</span>
             {% endif %}
            </td>
{% endfor %}
        {% for r in ept_reports.values %}
            <td>
            {% if p in r%}
                {{ r|dict_lookup:p }}
                {% else %}
                <span style="color:gray">n/a</span>
             {% endif %}
            </td>
{% endfor %}

        <td>            {% if p in em_totals %}
            {{ em_totals|dict_lookup:p }}
                        {% else %}
                <span style="color:gray">n/a</span>
             {% endif %}
        </td>
        <td>{% if p in ept_totals %}

            {{ ept_totals|dict_lookup:p }}
                        {% else %}
                <span style="color:gray">n/a</span>
             {% endif %}
        </td>
        </tr>
    {% endfor %}
    </tbody>
</table>

<div><span style="color:gray">n/a: no HSAs stock this product</span></div>
